---
// src/pages/Artists.astro
import Layout from '../layouts/Layout.astro';

// Define artists data with support for both images and videos
const artists = [
    {
        name: "3lijah",
        description: "3lijah are a hyper rock group based London that are building up to their first releases, this is your chance to be there at the start of something truly special. Over the last few months 3lijah have been releasing visuals teasing their upcoming tracks. Consider us well and truly teased, because we literally cannot wait for them to come out. Every single video comes with their signature mesmerising visuals and powerful sound. From the heavy guitar sounds on 'ribs' to the driving hook on 'skeletons', it feels like 3lijah are pulling out something new with every track. This really feels like the start of something huge, and we are so proud to be supporting their journey.",
        gallery: [
            { 
                type: "image", 
                src: "public/3lijahnologo1.png" 
            },
            { 
                type: "video", 
                src: "public/3lijah.mov", 
                poster: "public/3lijahmovstill.png" 
            },
            { 
                type: "image", 
                src: "public/3lijahnologo2.png" 
            }
        ],
        social: {
            instagram: "https://www.instagram.com/3lijah3lijah3lijah/",
            soundcloud: "https://soundcloud.com/3lijah-537323316?utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing",
            archive: "3lijah"
        }
    },
    {
        name: "Downtown<br>Kayoto",
        description: "An alternative indie/R&B/pop artist from Hull, Downtown has been turning heads since his first release in 2019. With cosigns from Pharrell Williams and Zane Lowe, Downtown Kayoto continues to make his mark on the industry. From fully choreographed performances in front of sold out crowds, to visual wizardry with every video he releases, this is not an artist to sleep on. His 2024 album 'Thinking With My Ears' delivered with every song, with 'Came Thru' and 'My Best' demonstrating the best of Downtown Kayoto's signature vibrant melodies and crazy production. We can't wait to see what he does next, and we're so proud to be supporting his career.",
        gallery: [
            { 
                type: "image", 
                src: "public/DKPortraitnologo_0.png" 
            },
            { 
                type: "video", 
                src: "public/downtownmov.mov", 
                poster: "public/downtownmovstill.png" 
            },
            { 
                type: "image", 
                src: "public/DKPortraitnologo_1.png" 
            }
        ],
        social: {
            instagram: "https://instagram.com/downtownkayoto",
            spotify: "https://open.spotify.com/artist/downtownkayoto",
            soundcloud: "https://soundcloud.com/downtownkayoto?utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing",
            appleMusic: "https://music.apple.com/gb/artist/downtown-kayoto/1291415870",
            archive: "downtownkayoto"
        }
    },
    {
        name: "Saint Demarcus",
        description: "An alternative artist based in London, Saint Demarcus is building a name for himself with a voice that brings so much emotion to his music. Every song from Saint feels refreshing and different, from his 2024 single 'Understand We', to his feature on Khakikid's 'Date Nite' and his latest track 'Better than Mine'. Blessing TV screens with his recent performance on Ireland's Late Late Show with Khakikid, Saint showed us that his voice is just as magnetic on the stage as in the studio. Saint Demarcus is truly one to watch and we are so proud to be supporting him on his journey.",
        gallery: [
            { 
                type: "image", 
                src: "public/SaintPortraitnologo_0.png" 
            },
            { 
                type: "video", 
                src: "public/saintmov.mov", 
                poster: "public/saintmovstill.png" 
            },
            { 
                type: "image", 
                src: "public/SaintPortraitnologo_1.png" 
            }
        ],
        social: {
            instagram: "https://instagram.com/saintdemarcus",
            spotify: "https://open.spotify.com/artist/saintdemarcus",
            soundcloud: "https://soundcloud.com/user226431639?utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing",
            appleMusic: "https://music.apple.com/gb/artist/saint-demarcus/1728530311",
            archive: "saintdemarcus"
        }
    }
];
---
<Layout title="Artists">
    <div class="min-h-[calc(100vh-5rem)] w-full py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                {artists.map((artist, index) => (
                    <div class="flex flex-col">
                        <div 
                            class="w-full aspect-[4/5] overflow-hidden mb-4 cursor-pointer transition-transform duration-300 hover:scale-105 hover:shadow-lg artist-card"
                            data-artist-index={index}
                        >
                            <img 
                                src={artist.gallery[0].src} 
                                alt={`${artist.name}'s artwork`} 
                                class="w-full h-full object-cover"
                                width="1080"
                                height="1350"
                            />
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden overflow-y-auto py-8">
        <div class="min-h-full w-full flex items-start justify-center">
            <div id="modal-content" class="bg-white rounded-lg overflow-hidden max-w-4xl w-full mx-auto flex flex-col md:flex-row relative">
                <!-- Close button - positioned outside of the content for better visibility -->
                <button id="close-modal" class="absolute top-2 right-2 rounded-full p-2 z-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                
                <!-- Main image/video container -->
                <div class="relative bg-gray-100 w-full md:w-2/3 h-auto">
                    <div id="carousel-container" class="w-full aspect-[4/5] relative overflow-hidden">
                        <div id="carousel-track" class="flex transition-transform duration-300 h-full">
                            <!-- Images/videos will be inserted here by JavaScript -->
                        </div>
                        
                        <!-- Navigation arrows -->
                        <button id="prev-slide" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white bg-opacity-50 rounded-full p-2 hover:bg-opacity-75 z-10">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <button id="next-slide" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white bg-opacity-50 rounded-full p-2 hover:bg-opacity-75 z-10">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Artist info -->
                <div class="w-full md:w-1/3 p-6 pt-12 font-baskerville bg-[#f2e8d5] max-h-96 md:max-h-full overflow-y-auto">
                    <h2 id="modal-artist-name" class="text-3xl font-bold mb-4 text-text-primary"></h2>
                    <p id="modal-artist-description" class="mb-6 text-gray-600"></p>
                    
                    <!-- Archive text -->
                    <p id="archive-text" class="mb-6 text-gray-600"></p>
                    
                    <!-- Social Media Links -->
                    <div id="social-links" class="flex flex-wrap gap-4 mt-6">
                        <!-- Social icons will be added here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script define:vars={{ artists }}>
        document.addEventListener('DOMContentLoaded', () => {
            const modalOverlay = document.getElementById('modal-overlay');
            const modalContent = document.getElementById('modal-content');
            const closeModal = document.getElementById('close-modal');
            const carouselTrack = document.getElementById('carousel-track');
            const modalArtistName = document.getElementById('modal-artist-name');
            const modalArtistDescription = document.getElementById('modal-artist-description');
            const socialLinks = document.getElementById('social-links');
            const prevSlide = document.getElementById('prev-slide');
            const nextSlide = document.getElementById('next-slide');
            
            let currentArtistIndex = 0;
            let currentSlideIndex = 0;
            let videoElements = [];

            // Social media icon SVGs
            const socialIcons = {
                instagram: `<img src="/icons/instagram.png" alt="Instagram" class="h-8 w-8">`,
                spotify: `<img src="/icons/spotify.png" alt="Spotify" class="h-8 w-8">`,
                soundcloud: `<img src="/icons/soundcloud.png" alt="SoundCloud" class="h-8 w-8">`,
                appleMusic: `<img src="/icons/applemusiclogo.png" alt="Apple Music" class="h-8 w-8">`
            };
            
            // Add click event listeners to all artist cards
            document.querySelectorAll('.artist-card').forEach(card => {
                card.addEventListener('click', () => {
                    currentArtistIndex = parseInt(card.dataset.artistIndex);
                    openModal(currentArtistIndex);
                });
            });
            
            // Close modal when clicking close button or outside the modal
            closeModal.addEventListener('click', () => {
                pauseAllVideos();
                modalOverlay.classList.add('hidden');
            });
            
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    pauseAllVideos();
                    modalOverlay.classList.add('hidden');
                }
            });
            
            // Prevent modal content clicks from closing modal
            modalContent.addEventListener('click', (e) => {
                e.stopPropagation();
            });
            
            // Carousel navigation
            prevSlide.addEventListener('click', (e) => {
                e.stopPropagation();
                navigateCarousel(-1);
            });
            
            nextSlide.addEventListener('click', (e) => {
                e.stopPropagation();
                navigateCarousel(1);
            });
            
            function openModal(artistIndex) {
                const artist = artists[artistIndex];
                modalArtistName.innerHTML = artist.name;
                modalArtistDescription.textContent = artist.description;
                
                // Clear existing social links
                socialLinks.innerHTML = '';
                const archiveText = document.getElementById('archive-text');
                if (artist.social && artist.social.archive) {
                    const artistName = artist.name.replace(/<br>/g, ' ');
                    archiveText.innerHTML = `Find ${artistName} on Archive <strong>@${artist.social.archive}</strong>`;
                } else {
                    archiveText.innerHTML = '';
                }
                // Add social media links dynamically
                if (artist.social) {
                    // Instagram
                    if (artist.social.instagram) {
                        addSocialLink('instagram', artist.social.instagram);
                    }
                    
                    // Spotify
                    if (artist.social.spotify) {
                        addSocialLink('spotify', artist.social.spotify);
                    }
                    
                    // SoundCloud
                    if (artist.social.soundcloud) {
                        addSocialLink('soundcloud', artist.social.soundcloud);
                    }
                    
                    // Apple Music
                    if (artist.social.appleMusic) {
                        addSocialLink('appleMusic', artist.social.appleMusic);
                    }
                }
                
                // Reset and populate carousel
                carouselTrack.innerHTML = '';
                currentSlideIndex = 0;
                videoElements = [];
                
                artist.gallery.forEach((item, index) => {
                    const slide = document.createElement('div');
                    slide.className = 'w-full h-full flex-shrink-0';
                    
                    if (item.type === 'image') {
                        const img = document.createElement('img');
                        img.src = item.src;
                        img.alt = `${artist.name}'s artwork ${index + 1}`;
                        img.className = 'w-full h-full object-cover';
                        slide.appendChild(img);
                    } else if (item.type === 'video') {
                        // Create video wrapper for positioning play button
                        const videoWrapper = document.createElement('div');
                        videoWrapper.className = 'relative w-full h-full';
                        
                        // Create video element
                        const video = document.createElement('video');
                        video.src = item.src;
                        video.poster = item.poster || '';
                        video.className = 'w-full h-full object-cover';
                        video.playsInline = true;
                        video.controls = false; // Hide default controls
                        video.dataset.slideIndex = index;
                        videoElements.push(video);
                        
                        // Create custom play button
                        const playButton = document.createElement('button');
                        playButton.className = 'absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-50 rounded-full w-20 h-20 flex items-center justify-center hover:bg-opacity-70 transition-all duration-300 z-10';
                        playButton.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" class="w-12 h-12">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        `;
                        
                        // Add event listeners for play/pause functionality
                        playButton.addEventListener('click', (e) => {
                            e.stopPropagation();
                            if (video.paused) {
                                video.play();
                                playButton.classList.add('opacity-0');
                                // Show controls when playing
                                video.controls = true;
                            } else {
                                video.pause();
                                playButton.classList.remove('opacity-0');
                            }
                        });
                        
                        // Show play button again when video ends
                        video.addEventListener('ended', () => {
                            playButton.classList.remove('opacity-0');
                            video.controls = false;
                        });
                        
                        // Show play button again when video is paused
                        video.addEventListener('pause', () => {
                            playButton.classList.remove('opacity-0');
                        });
                        
                        // Hide play button when video is playing
                        video.addEventListener('play', () => {
                            playButton.classList.add('opacity-0');
                            // Show controls when playing
                            video.controls = true;
                        });
                        
                        // Add elements to wrapper
                        videoWrapper.appendChild(video);
                        videoWrapper.appendChild(playButton);
                        slide.appendChild(videoWrapper);
                    }
                    
                    carouselTrack.appendChild(slide);
                });
                
                updateCarouselPosition();
                modalOverlay.classList.remove('hidden');
            }
            
            function addSocialLink(platform, url) {
                if (!url) return;
                
                const link = document.createElement('a');
                link.href = url;
                link.target = '_blank';
                link.className = 'social-link hover:opacity-75 transition-opacity'; // Simplified styling
                link.innerHTML = socialIcons[platform] || '';
                
                socialLinks.appendChild(link);
            }
            
            function navigateCarousel(direction) {
                pauseAllVideos();
                const totalSlides = artists[currentArtistIndex].gallery.length;
                currentSlideIndex = (currentSlideIndex + direction + totalSlides) % totalSlides;
                updateCarouselPosition();
                
                // Reset video state when navigating
                const currentMedia = artists[currentArtistIndex].gallery[currentSlideIndex];
                if (currentMedia && currentMedia.type === 'video') {
                    const video = videoElements.find(v => parseInt(v.dataset.slideIndex) === currentSlideIndex);
                    if (video) {
                        video.controls = false;
                        
                        const videoWrapper = video.parentElement;
                        if (videoWrapper) {
                            const playButton = videoWrapper.querySelector('button');
                            if (playButton) {
                                playButton.classList.remove('opacity-0');
                            }
                        }
                    }
                }
            }
            
            function updateCarouselPosition() {
                carouselTrack.style.transform = `translateX(-${currentSlideIndex * 100}%)`;
            }
            
            function pauseAllVideos() {
                videoElements.forEach(video => {
                    if (!video.paused) {
                        video.pause();
                    }
                    video.controls = false;
                    
                    const videoWrapper = video.parentElement;
                    if (videoWrapper) {
                        const playButton = videoWrapper.querySelector('button');
                        if (playButton) {
                            playButton.classList.remove('opacity-0');
                        }
                    }
                });
            }
            
            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (modalOverlay.classList.contains('hidden')) return;
                
                if (e.key === 'ArrowLeft') navigateCarousel(-1);
                else if (e.key === 'ArrowRight') navigateCarousel(1);
                else if (e.key === 'Escape') {
                    pauseAllVideos();
                    modalOverlay.classList.add('hidden');
                }
            });
        });
    </script>
</Layout>